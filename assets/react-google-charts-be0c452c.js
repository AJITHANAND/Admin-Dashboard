import{r as i}from"./react-76f7fb99.js";function A(l,n,t){i.useEffect(()=>{if(!document)return;const o=document.querySelector('script[src="'.concat(l,'"]'));if(o!=null&&o.dataset.loaded){n==null||n();return}const r=o||document.createElement("script");o||(r.src=l);const e=()=>{r.dataset.loaded="1",n==null||n()};return r.addEventListener("load",e),t&&r.addEventListener("error",t),o||document.head.append(r),()=>{r.removeEventListener("load",e),t&&r.removeEventListener("error",t)}},[])}function P(l){let{chartVersion:n="current",chartPackages:t=["corechart","controls"],chartLanguage:o="en",mapsApiKey:r}=l;const[e,a]=i.useState(null),[c,d]=i.useState(!1);return A("https://www.gstatic.com/charts/loader.js",()=>{const s=window==null?void 0:window.google;s&&(s.charts.load(n,{packages:t,language:o,mapsApiKey:r}),s.charts.setOnLoadCallback(()=>{a(s)}))},()=>{d(!0)}),[e,c]}function O(l){let{onLoad:n,onError:t,...o}=l;const[r,e]=P(o);return i.useEffect(()=>{r&&n&&n(r)},[r]),i.useEffect(()=>{e&&t&&t()},[e]),null}const F={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{}};let E=0;const _=()=>(E+=1,"reactgooglegraph-".concat(E)),x=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],k=async function(l,n){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((o,r)=>{const e="".concat(t.headers?"headers=".concat(t.headers):"headers=0"),a="".concat(t.query?"&tq=".concat(encodeURIComponent(t.query)):""),c="".concat(t.gid?"&gid=".concat(t.gid):""),d="".concat(t.sheet?"&sheet=".concat(t.sheet):""),s="".concat(t.access_token?"&access_token=".concat(t.access_token):""),h="".concat(e).concat(c).concat(d).concat(a).concat(s),p="".concat(n,"/gviz/tq?").concat(h);new l.visualization.Query(p).send(f=>{f.isError()?r("Error in query:  ".concat(f.getMessage()," ").concat(f.getDetailedMessage())):o(f.getDataTable())})})},{Provider:M,Consumer:U}=i.createContext(F),q=l=>{let{children:n,value:t}=l;return i.createElement(M,{value:t},n)},T=l=>{let{render:n}=l;return i.createElement(U,null,t=>n(t))},R="#CCCCCC";class B extends i.Component{componentDidMount(){this.draw(this.props),window.addEventListener("resize",this.onResize),(this.props.legend_toggle||this.props.legendToggle)&&this.listenToLegendToggle()}componentWillUnmount(){const{google:n,googleChartWrapper:t}=this.props;window.removeEventListener("resize",this.onResize),n.visualization.events.removeAllListeners(t),t.getChartType()==="Timeline"&&t.getChart()&&t.getChart().clearChart()}componentDidUpdate(){this.draw(this.props)}render(){return null}constructor(...n){super(...n),this.state={hiddenColumns:[]},this.listenToLegendToggle=()=>{const{google:t,googleChartWrapper:o}=this.props;t.visualization.events.addListener(o,"select",()=>{const e=o.getChart().getSelection(),a=o.getDataTable();if(e.length===0||e[0].row||!a)return;const c=e[0].column,d=this.getColumnID(a,c);this.state.hiddenColumns.includes(d)?this.setState(s=>({...s,hiddenColumns:[...s.hiddenColumns.filter(h=>h!==d)]})):this.setState(s=>({...s,hiddenColumns:[...s.hiddenColumns,d]}))})},this.applyFormatters=(t,o)=>{const{google:r}=this.props;for(let e of o)switch(e.type){case"ArrowFormat":{new r.visualization.ArrowFormat(e.options).format(t,e.column);break}case"BarFormat":{new r.visualization.BarFormat(e.options).format(t,e.column);break}case"ColorFormat":{const a=new r.visualization.ColorFormat(e.options),{ranges:c}=e;for(let d of c)a.addRange(...d);a.format(t,e.column);break}case"DateFormat":{new r.visualization.DateFormat(e.options).format(t,e.column);break}case"NumberFormat":{new r.visualization.NumberFormat(e.options).format(t,e.column);break}case"PatternFormat":{new r.visualization.PatternFormat(e.options).format(t,e.column);break}}},this.getColumnID=(t,o)=>t.getColumnId(o)||t.getColumnLabel(o),this.draw=async t=>{let{data:o,diffdata:r,rows:e,columns:a,options:c,legend_toggle:d,legendToggle:s,chartType:h,formatters:p,spreadSheetUrl:C,spreadSheetQueryParameters:f}=t;const{google:m,googleChartWrapper:g}=this.props;let u,D=null;if(r){const v=m.visualization.arrayToDataTable(r.old),w=m.visualization.arrayToDataTable(r.new);D=m.visualization[h].prototype.computeDiff(v,w)}o!==null?Array.isArray(o)?u=m.visualization.arrayToDataTable(o):u=new m.visualization.DataTable(o):e&&a?u=m.visualization.arrayToDataTable([a,...e]):C?u=await k(m,C,f):u=m.visualization.arrayToDataTable([]);const b=u.getNumberOfColumns();for(let v=0;v<b;v+=1){const w=this.getColumnID(u,v);if(this.state.hiddenColumns.includes(w)){const W=u.getColumnLabel(v),L=u.getColumnId(v),S=u.getColumnType(v);u.removeColumn(v),u.addColumn({label:W,id:L,type:S})}}const y=g.getChart();g.getChartType()==="Timeline"&&y&&y.clearChart(),g.setChartType(h),g.setOptions(c||{}),g.setDataTable(u),g.draw(),this.props.googleChartDashboard!==null&&this.props.googleChartDashboard.draw(u),D&&(g.setDataTable(D),g.draw()),p&&(this.applyFormatters(u,p),g.setDataTable(u),g.draw()),(s===!0||d===!0)&&this.grayOutHiddenColumns({options:c})},this.grayOutHiddenColumns=t=>{let{options:o}=t;const{googleChartWrapper:r}=this.props,e=r.getDataTable();if(!e)return;const a=e.getNumberOfColumns();if(this.state.hiddenColumns.length>0===!1)return;const d=Array.from({length:a-1}).map((s,h)=>{const p=this.getColumnID(e,h+1);return this.state.hiddenColumns.includes(p)?R:o&&o.colors?o.colors[h]:x[h]});r.setOptions({...o,colors:d}),r.draw()},this.onResize=()=>{const{googleChartWrapper:t}=this.props;t.draw()}}}class N extends i.Component{componentDidMount(){}componentWillUnmount(){}shouldComponentUpdate(){return!1}render(){const{google:n,googleChartWrapper:t,googleChartDashboard:o}=this.props;return i.createElement(T,{render:r=>i.createElement(B,Object.assign({},r,{google:n,googleChartWrapper:t,googleChartDashboard:o}))})}}class G extends i.Component{shouldComponentUpdate(){return!1}listenToEvents(n){let{chartEvents:t,google:o,googleChartWrapper:r}=n;if(t){o.visualization.events.removeAllListeners(r);for(let a of t){var e=this;const{eventName:c,callback:d}=a;o.visualization.events.addListener(r,c,function(){for(var s=arguments.length,h=new Array(s),p=0;p<s;p++)h[p]=arguments[p];d({chartWrapper:r,props:e.props,google:o,eventArgs:h})})}}}componentDidMount(){var n;const{google:t,googleChartWrapper:o}=this.props;this.listenToEvents({chartEvents:((n=this.propsFromContext)===null||n===void 0?void 0:n.chartEvents)||null,google:t,googleChartWrapper:o})}render(){return this.props,i.createElement(T,{render:n=>(this.propsFromContext=n,null)})}constructor(n){super(n),this.propsFromContext=null}}let z=0;class H extends i.Component{componentDidMount(){const{options:n,google:t,chartType:o,chartWrapperParams:r,toolbarItems:e,getChartEditor:a,getChartWrapper:c}=this.props,d={chartType:o,options:n,containerId:this.getGraphID(),...r},s=new t.visualization.ChartWrapper(d);s.setOptions(n||{}),c&&c(s,t);const h=new t.visualization.Dashboard(this.dashboard_ref),p=this.addControls(s,h);e&&t.visualization.drawToolbar(this.toolbar_ref.current,e);let C=null;a&&(C=new t.visualization.ChartEditor,a({chartEditor:C,chartWrapper:s,google:t})),this.setState({googleChartEditor:C,googleChartControls:p,googleChartDashboard:h,googleChartWrapper:s,isReady:!0})}componentDidUpdate(){if(!this.state.googleChartWrapper||!this.state.googleChartDashboard||!this.state.googleChartControls)return;const{controls:n}=this.props;if(n)for(let t=0;t<n.length;t+=1){const{controlType:o,options:r,controlWrapperParams:e}=n[t];e&&"state"in e&&this.state.googleChartControls[t].control.setState(e.state),this.state.googleChartControls[t].control.setOptions(r),this.state.googleChartControls[t].control.setControlType(o)}}shouldComponentUpdate(n,t){return this.state.isReady!==t.isReady||n.controls!==this.props.controls}render(){const{width:n,height:t,options:o,style:r}=this.props,e={height:t||o&&o.height,width:n||o&&o.width,...r};return this.props.render?i.createElement("div",{ref:this.dashboard_ref,style:e},i.createElement("div",{ref:this.toolbar_ref,id:"toolbar"}),this.props.render({renderChart:this.renderChart,renderControl:this.renderControl,renderToolbar:this.renderToolBar})):i.createElement("div",{ref:this.dashboard_ref,style:e},this.renderControl(a=>{let{controlProp:c}=a;return c.controlPosition!=="bottom"}),this.renderChart(),this.renderControl(a=>{let{controlProp:c}=a;return c.controlPosition==="bottom"}),this.renderToolBar())}constructor(...n){var t;super(...n),t=this,this.state={googleChartWrapper:null,googleChartDashboard:null,googleChartControls:null,googleChartEditor:null,isReady:!1},this.graphID=null,this.dashboard_ref=i.createRef(),this.toolbar_ref=i.createRef(),this.getGraphID=()=>{const{graphID:o,graph_id:r}=this.props;let e;return!o&&!r?this.graphID?e=this.graphID:e=_():o&&!r?e=o:r&&!o?e=r:e=o,this.graphID=e,this.graphID},this.getControlID=(o,r)=>{z+=1;let e;return typeof o>"u"?e="googlechart-control-".concat(r,"-").concat(z):e=o,e},this.addControls=(o,r)=>{const{google:e,controls:a}=this.props,c=a?a.map((s,h)=>{const{controlID:p,controlType:C,options:f,controlWrapperParams:m}=s,g=this.getControlID(p,h);return{controlProp:s,control:new e.visualization.ControlWrapper({containerId:g,controlType:C,options:f,...m})}}):null;if(!c)return null;r.bind(c.map(s=>{let{control:h}=s;return h}),o);for(let s of c){const{control:h,controlProp:p}=s,{controlEvents:C=[]}=p;for(let f of C){var d=this;const{callback:m,eventName:g}=f;e.visualization.events.removeListener(h,g,m),e.visualization.events.addListener(h,g,function(){for(var u=arguments.length,D=new Array(u),b=0;b<u;b++)D[b]=arguments[b];m({chartWrapper:o,controlWrapper:h,props:d.props,google:e,eventArgs:D})})}}return c},this.renderChart=()=>{const{width:o,height:r,options:e,style:a,className:c,rootProps:d,google:s}=this.props,h={height:r||e&&e.height,width:o||e&&e.width,...a};return i.createElement("div",Object.assign({id:this.getGraphID(),style:h,className:c},d),this.state.isReady&&this.state.googleChartWrapper!==null?i.createElement(i.Fragment,null,i.createElement(N,{googleChartWrapper:this.state.googleChartWrapper,google:s,googleChartDashboard:this.state.googleChartDashboard}),i.createElement(G,{googleChartWrapper:this.state.googleChartWrapper,google:s})):null)},this.renderControl=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r=>!0;return t.state.isReady&&t.state.googleChartControls!==null?i.createElement(i.Fragment,null,t.state.googleChartControls.filter(r=>{let{controlProp:e,control:a}=r;return o({control:a,controlProp:e})}).map(r=>{let{control:e,controlProp:a}=r;return i.createElement("div",{key:e.getContainerId(),id:e.getContainerId()})})):null},this.renderToolBar=()=>this.props.toolbarItems?i.createElement("div",{ref:this.toolbar_ref}):null}}class j extends i.Component{render(){const{chartLanguage:n,chartPackages:t,chartVersion:o,mapsApiKey:r,loader:e,errorElement:a}=this.props;return i.createElement(q,{value:this.props},this.state.loadingStatus==="ready"&&this.state.google!==null?i.createElement(H,Object.assign({},this.props,{google:this.state.google})):this.state.loadingStatus==="errored"&&a?a:e,i.createElement(O,{chartLanguage:n,chartPackages:t,chartVersion:o,mapsApiKey:r,onLoad:this.onLoad,onError:this.onError}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}isFullyLoaded(n){const{controls:t,toolbarItems:o,getChartEditor:r}=this.props;return n&&n.visualization&&n.visualization.ChartWrapper&&n.visualization.Dashboard&&(!t||n.visualization.ChartWrapper)&&(!r||n.visualization.ChartEditor)&&(!o||n.visualization.drawToolbar)}constructor(...n){super(...n),this._isMounted=!1,this.state={loadingStatus:"loading",google:null},this.onLoad=t=>{if(this.props.onLoad&&this.props.onLoad(t),this.isFullyLoaded(t))this.onSuccess(t);else{const o=setInterval(()=>{const r=window.google;this._isMounted?r&&this.isFullyLoaded(r)&&(clearInterval(o),this.onSuccess(r)):clearInterval(o)},1e3)}},this.onSuccess=t=>{this.setState({loadingStatus:"ready",google:t})},this.onError=()=>{this.setState({loadingStatus:"errored"})}}}j.defaultProps=F;var I;(function(l){l.annotation="annotation",l.annotationText="annotationText",l.certainty="certainty",l.emphasis="emphasis",l.interval="interval",l.scope="scope",l.style="style",l.tooltip="tooltip",l.domain="domain"})(I||(I={}));export{j as C};
